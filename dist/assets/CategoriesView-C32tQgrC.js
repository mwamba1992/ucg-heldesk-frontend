import{d as j,R as H,B as g,l as v,e as a,w as t,x as s,g as I,a4 as N,z as u,S as y,o as d,j as n,c as D,J,F as S,K,H as R,aa as Z,t as C,P as _,q as w,ab as G,n as T,I as O,a5 as Q,T as $,k as z,r as W,s as X,v as Y,a0 as h,Z as ee,a3 as B,N as L}from"./index-Cix3CRG3.js";const ae={class:"d-flex justify-space-between align-center mb-6"},le={key:1,class:"text-center py-8"},te={key:2,class:"text-center py-8"},ne=j({__name:"CategoriesView",setup(ie){const V=u(!1),x=u([]),m=u(!1),f=u(!1),r=u(null),b=u(!1),p=u(!1),o=u({name:"",description:"",parentId:""}),U={name:[i=>!!i||"Name is required"]};async function k(){V.value=!0;try{const i=await y.get("/categories?includeInactive=true");x.value=i.data}catch(i){console.error("Failed to fetch categories:",i)}finally{V.value=!1}}function A(){f.value=!1,r.value=null,o.value={name:"",description:"",parentId:""},m.value=!0}function M(i){f.value=!0,r.value=i,o.value={name:i.name,description:i.description||"",parentId:i.parentId||""},m.value=!0}function q(i){r.value=i,p.value=!0}async function F(){if(o.value.name){b.value=!0;try{const i={name:o.value.name};o.value.description&&(i.description=o.value.description),o.value.parentId&&(i.parentId=o.value.parentId),f.value&&r.value?await y.patch(`/categories/${r.value.id}`,i):await y.post("/categories",i),m.value=!1,await k()}catch(i){console.error("Failed to save category:",i)}finally{b.value=!1}}}async function E(){if(r.value)try{await y.delete(`/categories/${r.value.id}`),p.value=!1,await k()}catch(i){console.error("Failed to delete category:",i)}}async function P(i){try{await y.patch(`/categories/${i.id}`,{isActive:!i.isActive}),await k()}catch(e){console.error("Failed to update category:",e)}}return H(k),(i,e)=>(d(),g("div",null,[v("div",ae,[e[8]||(e[8]=v("div",null,[v("h1",{class:"text-h4"},"Categories"),v("p",{class:"text-body-2 text-grey"},"Manage ticket categories")],-1)),a(s,{color:"primary","prepend-icon":"mdi-plus",onClick:A},{default:t(()=>[...e[7]||(e[7]=[n(" Add Category ",-1)])]),_:1})]),a(I,null,{default:t(()=>[x.value.length>0?(d(),D(J,{key:0},{default:t(()=>[(d(!0),g(S,null,K(x.value,l=>(d(),g(S,{key:l.id},[a(R,null,{prepend:t(()=>[a(T,{color:l.isActive?"primary":"grey"},{default:t(()=>[...e[9]||(e[9]=[n("mdi-folder",-1)])]),_:1},8,["color"])]),append:t(()=>[a(s,{icon:"mdi-pencil",variant:"text",size:"small",onClick:c=>M(l)},null,8,["onClick"]),a(s,{icon:l.isActive?"mdi-eye-off":"mdi-eye",variant:"text",size:"small",onClick:c=>P(l)},null,8,["icon","onClick"]),a(s,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:c=>q(l)},null,8,["onClick"])]),default:t(()=>[a(Z,null,{default:t(()=>[n(C(l.name)+" ",1),l.isActive?w("",!0):(d(),D(_,{key:0,size:"x-small",color:"grey",class:"ml-2"},{default:t(()=>[...e[10]||(e[10]=[n(" Inactive ",-1)])]),_:1}))]),_:2},1024),l.description?(d(),D(G,{key:0},{default:t(()=>[n(C(l.description),1)]),_:2},1024)):w("",!0)]),_:2},1024),a(O)],64))),128))]),_:1})):V.value?w("",!0):(d(),g("div",le,[a(T,{size:"64",color:"grey-lighten-1"},{default:t(()=>[...e[11]||(e[11]=[n("mdi-folder-multiple",-1)])]),_:1}),e[13]||(e[13]=v("p",{class:"text-h6 mt-4"},"No categories found",-1)),e[14]||(e[14]=v("p",{class:"text-body-2 text-grey"},"Create your first category",-1)),a(s,{color:"primary",class:"mt-4",onClick:A},{default:t(()=>[...e[12]||(e[12]=[n(" Add Category ",-1)])]),_:1})])),V.value?(d(),g("div",te,[a(Q,{indeterminate:"",color:"primary"})])):w("",!0)]),_:1}),a(N,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value=l),"max-width":"500"},{default:t(()=>[a(I,null,{default:t(()=>[a($,null,{default:t(()=>[n(C(f.value?"Edit Category":"Create Category"),1)]),_:1}),a(z,null,{default:t(()=>[a(W,{onSubmit:X(F,["prevent"])},{default:t(()=>[a(Y,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.name=l),label:"Name",rules:U.name,required:"",class:"mb-4"},null,8,["modelValue","rules"]),a(h,{modelValue:o.value.description,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.description=l),label:"Description",rows:"3",class:"mb-4"},null,8,["modelValue"]),a(ee,{modelValue:o.value.parentId,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.parentId=l),items:x.value.filter(l=>{var c;return l.id!==((c=r.value)==null?void 0:c.id)}),"item-title":"name","item-value":"id",label:"Parent Category (optional)",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(B,null,{default:t(()=>[a(L),a(s,{variant:"text",onClick:e[3]||(e[3]=l=>m.value=!1)},{default:t(()=>[...e[15]||(e[15]=[n("Cancel",-1)])]),_:1}),a(s,{color:"primary",loading:b.value,disabled:!o.value.name,onClick:F},{default:t(()=>[n(C(f.value?"Save Changes":"Create"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=l=>p.value=l),"max-width":"400"},{default:t(()=>[a(I,null,{default:t(()=>[a($,null,{default:t(()=>[...e[16]||(e[16]=[n("Delete Category",-1)])]),_:1}),a(z,null,{default:t(()=>{var l;return[n(' Are you sure you want to deactivate the category "'+C((l=r.value)==null?void 0:l.name)+'"? This will hide it from the category selection. ',1)]}),_:1}),a(B,null,{default:t(()=>[a(L),a(s,{variant:"text",onClick:e[5]||(e[5]=l=>p.value=!1)},{default:t(()=>[...e[17]||(e[17]=[n("Cancel",-1)])]),_:1}),a(s,{color:"error",onClick:E},{default:t(()=>[...e[18]||(e[18]=[n("Deactivate",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{ne as default};
