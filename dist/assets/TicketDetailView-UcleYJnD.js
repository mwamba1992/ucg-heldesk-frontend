import{d as me,b as fe,W as p,X as $,R as ve,B as c,e as l,w as t,$ as pe,x as m,c as f,V as Z,q as I,a4 as Q,z as d,A as Y,S as V,a as ce,u as ye,o as r,j as s,a5 as ge,f as k,g as C,T as D,l as o,t as n,P as z,k as N,I as h,a3 as W,n as S,a6 as Ve,F as ke,K as Ce,a7 as be,a8 as xe,r as Ae,s as we,a0 as Ie,a9 as De,J as Ne,H as M,aa as P,ab as O,Z as j,N as ee,ac as q}from"./index-Cix3CRG3.js";const Se={key:0,class:"text-center py-8"},Ee={class:"text-primary font-weight-bold"},Te={class:"text-h5 mt-2"},Re={key:0,class:"text-body-1 mb-4"},_e={key:1,class:"text-grey text-body-2 mb-4"},Le={key:0,class:"text-center py-4 text-grey"},Ue={class:"text-caption text-grey"},$e={class:"d-flex justify-space-between align-center mb-2"},Me={class:"font-weight-medium"},Pe={class:"text-body-2"},Oe={class:"d-flex justify-space-between align-center"},Fe={key:1},He=me({__name:"TicketDetailView",setup(Ge){const b=ce(),J=ye(),te=fe(),F=d(!0),u=d(null),E=d([]),K=d([]),y=d(""),T=d(!1),R=d(!1),x=d(!1),A=d(!1),g=d(""),v=d({status:"",priority:""}),G=Y(()=>te.user),B=Y(()=>{var i,e,a;return((i=G.value)==null?void 0:i.role)===q.AGENT||((e=G.value)==null?void 0:e.role)===q.SUPERVISOR||((a=G.value)==null?void 0:a.role)===q.ADMIN}),le={NEW:"blue",ASSIGNED:"purple",IN_PROGRESS:"orange",PENDING:"amber",RESOLVED:"green",CLOSED:"grey",CANCELLED:"red"},ae={CRITICAL:"red",HIGH:"orange",MEDIUM:"amber",LOW:"green"},se=[{title:"New",value:p.NEW},{title:"Assigned",value:p.ASSIGNED},{title:"In Progress",value:p.IN_PROGRESS},{title:"Pending",value:p.PENDING},{title:"Resolved",value:p.RESOLVED},{title:"Closed",value:p.CLOSED},{title:"Cancelled",value:p.CANCELLED}],ue=[{title:"Critical",value:$.CRITICAL},{title:"High",value:$.HIGH},{title:"Medium",value:$.MEDIUM},{title:"Low",value:$.LOW}];async function _(){F.value=!0;try{const[i,e]=await Promise.all([V.get(`/tickets/${b.params.id}`),V.get(`/tickets/${b.params.id}/comments`)]);u.value=i.data,E.value=e.data,v.value.status=u.value.status,v.value.priority=u.value.priority}catch(i){console.error("Failed to fetch ticket:",i),J.push("/tickets")}finally{F.value=!1}}async function ie(){try{const i=await V.get("/users?role=AGENT&isActive=true");K.value=i.data.data}catch(i){console.error("Failed to fetch agents:",i)}}async function oe(){if(y.value.trim()){R.value=!0;try{await V.post(`/tickets/${b.params.id}/comments`,{body:y.value,isInternal:T.value}),y.value="",T.value=!1,await _()}catch(i){console.error("Failed to add comment:",i)}finally{R.value=!1}}}async function ne(){try{await V.patch(`/tickets/${b.params.id}`,v.value),x.value=!1,await _()}catch(i){console.error("Failed to update ticket:",i)}}async function re(){if(g.value)try{await V.patch(`/tickets/${b.params.id}/assign`,{assignedTo:g.value}),A.value=!1,g.value="",await _()}catch(i){console.error("Failed to assign ticket:",i)}}function w(i){return new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function de(i){const e=new Date(i),L=new Date().getTime()-e.getTime(),U=Math.floor(L/6e4),H=Math.floor(U/60),X=Math.floor(H/24);return U<1?"Just now":U<60?`${U}m ago`:H<24?`${H}h ago`:X<7?`${X}d ago`:w(i)}return ve(()=>{_(),B.value&&ie()}),(i,e)=>(r(),c("div",null,[l(m,{variant:"text","prepend-icon":"mdi-arrow-left",class:"mb-4",onClick:e[0]||(e[0]=a=>pe(J).push("/tickets"))},{default:t(()=>[...e[12]||(e[12]=[s(" Back to Tickets ",-1)])]),_:1}),F.value?(r(),c("div",Se,[l(ge,{indeterminate:"",color:"primary"})])):u.value?(r(),f(Z,{key:1},{default:t(()=>[l(k,{cols:"12",md:"8"},{default:t(()=>[l(C,{class:"mb-4"},{default:t(()=>[l(D,{class:"d-flex justify-space-between align-center"},{default:t(()=>[o("div",null,[o("span",Ee,n(u.value.ticketNumber),1),o("h2",Te,n(u.value.title),1)]),o("div",null,[l(z,{color:le[u.value.status],variant:"flat",class:"mr-2"},{default:t(()=>[s(n(u.value.status.replace("_"," ")),1)]),_:1},8,["color"]),l(z,{color:ae[u.value.priority],variant:"flat"},{default:t(()=>[s(n(u.value.priority),1)]),_:1},8,["color"])])]),_:1}),l(N,null,{default:t(()=>[u.value.description?(r(),c("div",Re,n(u.value.description),1)):(r(),c("div",_e," No description provided ")),l(h,{class:"my-4"}),l(Z,null,{default:t(()=>[l(k,{cols:"6",md:"3"},{default:t(()=>[e[13]||(e[13]=o("div",{class:"text-caption text-grey"},"Created",-1)),o("div",null,n(w(u.value.createdAt)),1)]),_:1}),l(k,{cols:"6",md:"3"},{default:t(()=>{var a;return[e[14]||(e[14]=o("div",{class:"text-caption text-grey"},"Category",-1)),o("div",null,n(((a=u.value.category)==null?void 0:a.name)||"Uncategorized"),1)]}),_:1}),l(k,{cols:"6",md:"3"},{default:t(()=>[e[15]||(e[15]=o("div",{class:"text-caption text-grey"},"Location",-1)),o("div",null,n(u.value.location||"-"),1)]),_:1}),l(k,{cols:"6",md:"3"},{default:t(()=>[e[16]||(e[16]=o("div",{class:"text-caption text-grey"},"SLA Due",-1)),o("div",null,n(u.value.slaDueAt?w(u.value.slaDueAt):"-"),1)]),_:1})]),_:1})]),_:1}),B.value?(r(),f(W,{key:0},{default:t(()=>[l(m,{variant:"outlined","prepend-icon":"mdi-pencil",onClick:e[1]||(e[1]=a=>x.value=!0)},{default:t(()=>[...e[17]||(e[17]=[s(" Edit ",-1)])]),_:1}),l(m,{variant:"outlined","prepend-icon":"mdi-account-plus",onClick:e[2]||(e[2]=a=>A.value=!0)},{default:t(()=>[...e[18]||(e[18]=[s(" Assign ",-1)])]),_:1})]),_:1})):I("",!0)]),_:1}),l(C,null,{default:t(()=>[l(D,null,{default:t(()=>[l(S,{class:"mr-2"},{default:t(()=>[...e[19]||(e[19]=[s("mdi-comment-multiple",-1)])]),_:1}),s(" Comments ("+n(E.value.length)+") ",1)]),_:1}),l(N,null,{default:t(()=>[E.value.length===0?(r(),c("div",Le," No comments yet ")):(r(),f(Ve,{key:1,density:"compact",side:"end"},{default:t(()=>[(r(!0),c(ke,null,Ce(E.value,a=>(r(),f(be,{key:a.id,"dot-color":a.isInternal?"amber":"primary",size:"small"},{opposite:t(()=>[o("span",Ue,n(de(a.createdAt)),1)]),default:t(()=>[l(C,{variant:"outlined",class:xe({"bg-amber-lighten-5":a.isInternal})},{default:t(()=>[l(N,null,{default:t(()=>{var L;return[o("div",$e,[o("div",Me,[s(n((L=a.author)==null?void 0:L.fullName)+" ",1),a.isInternal?(r(),f(z,{key:0,size:"x-small",color:"amber",class:"ml-2"},{default:t(()=>[...e[20]||(e[20]=[s(" Internal ",-1)])]),_:1})):I("",!0)])]),o("div",Pe,n(a.body),1)]}),_:2},1024)]),_:2},1032,["class"])]),_:2},1032,["dot-color"]))),128))]),_:1})),l(h,{class:"my-4"}),l(Ae,{onSubmit:we(oe,["prevent"])},{default:t(()=>[l(Ie,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),label:"Add a comment",rows:"3","auto-grow":"",disabled:R.value},null,8,["modelValue","disabled"]),o("div",Oe,[B.value?(r(),f(De,{key:0,modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=a=>T.value=a),label:"Internal note (hidden from requester)",density:"compact","hide-details":""},null,8,["modelValue"])):(r(),c("div",Fe)),l(m,{type:"submit",color:"primary",loading:R.value,disabled:!y.value.trim()},{default:t(()=>[...e[21]||(e[21]=[s(" Add Comment ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1}),l(k,{cols:"12",md:"4"},{default:t(()=>[l(C,{class:"mb-4"},{default:t(()=>[l(D,null,{default:t(()=>[...e[22]||(e[22]=[s("Details",-1)])]),_:1}),l(Ne,{density:"compact"},{default:t(()=>[l(M,null,{prepend:t(()=>[l(S,null,{default:t(()=>[...e[23]||(e[23]=[s("mdi-account",-1)])]),_:1})]),default:t(()=>[l(P,null,{default:t(()=>[...e[24]||(e[24]=[s("Requester",-1)])]),_:1}),l(O,null,{default:t(()=>{var a;return[s(n((a=u.value.requester)==null?void 0:a.fullName),1)]}),_:1})]),_:1}),l(M,null,{prepend:t(()=>[l(S,null,{default:t(()=>[...e[25]||(e[25]=[s("mdi-account-tie",-1)])]),_:1})]),default:t(()=>[l(P,null,{default:t(()=>[...e[26]||(e[26]=[s("Assigned To",-1)])]),_:1}),l(O,null,{default:t(()=>{var a;return[s(n(((a=u.value.assignee)==null?void 0:a.fullName)||"Unassigned"),1)]}),_:1})]),_:1}),u.value.firstResponseAt?(r(),f(M,{key:0},{prepend:t(()=>[l(S,null,{default:t(()=>[...e[27]||(e[27]=[s("mdi-clock-check",-1)])]),_:1})]),default:t(()=>[l(P,null,{default:t(()=>[...e[28]||(e[28]=[s("First Response",-1)])]),_:1}),l(O,null,{default:t(()=>[s(n(w(u.value.firstResponseAt)),1)]),_:1})]),_:1})):I("",!0),u.value.resolvedAt?(r(),f(M,{key:1},{prepend:t(()=>[l(S,null,{default:t(()=>[...e[29]||(e[29]=[s("mdi-check-circle",-1)])]),_:1})]),default:t(()=>[l(P,null,{default:t(()=>[...e[30]||(e[30]=[s("Resolved",-1)])]),_:1}),l(O,null,{default:t(()=>[s(n(w(u.value.resolvedAt)),1)]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):I("",!0),l(Q,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=a=>x.value=a),"max-width":"500"},{default:t(()=>[l(C,null,{default:t(()=>[l(D,null,{default:t(()=>[...e[31]||(e[31]=[s("Edit Ticket",-1)])]),_:1}),l(N,null,{default:t(()=>[l(j,{modelValue:v.value.status,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.status=a),items:se,label:"Status",class:"mb-4"},null,8,["modelValue"]),l(j,{modelValue:v.value.priority,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.priority=a),items:ue,label:"Priority"},null,8,["modelValue"])]),_:1}),l(W,null,{default:t(()=>[l(ee),l(m,{variant:"text",onClick:e[7]||(e[7]=a=>x.value=!1)},{default:t(()=>[...e[32]||(e[32]=[s("Cancel",-1)])]),_:1}),l(m,{color:"primary",onClick:ne},{default:t(()=>[...e[33]||(e[33]=[s("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:A.value,"onUpdate:modelValue":e[11]||(e[11]=a=>A.value=a),"max-width":"500"},{default:t(()=>[l(C,null,{default:t(()=>[l(D,null,{default:t(()=>[...e[34]||(e[34]=[s("Assign Ticket",-1)])]),_:1}),l(N,null,{default:t(()=>[l(j,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),items:K.value,"item-title":"fullName","item-value":"id",label:"Select Agent"},null,8,["modelValue","items"])]),_:1}),l(W,null,{default:t(()=>[l(ee),l(m,{variant:"text",onClick:e[10]||(e[10]=a=>A.value=!1)},{default:t(()=>[...e[35]||(e[35]=[s("Cancel",-1)])]),_:1}),l(m,{color:"primary",onClick:re,disabled:!g.value},{default:t(()=>[...e[36]||(e[36]=[s("Assign",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{He as default};
