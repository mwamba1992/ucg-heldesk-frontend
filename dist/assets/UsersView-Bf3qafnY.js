import{d as Q,z as u,ac as m,Y as j,R as G,B as L,l as v,e as t,w as s,x as V,g as S,a4 as _,S as A,o as Y,j as n,k as q,V as C,f as p,Z as R,_ as Z,n as H,t as g,P as D,T as J,r as K,s as W,v as c,a3 as X,N as h}from"./index-Cix3CRG3.js";const ee={class:"d-flex justify-space-between align-center mb-6"},le={class:"text-center py-8"},se=Q({__name:"UsersView",setup(ae){const N=u(!1),k=u([]),x=u(0),w=u(1),U=u(10),i=u({role:"",isActive:""}),d=u(!1),r=u(!1),y=u(null),E=u(!1),o=u({username:"",email:"",fullName:"",password:"",role:m.REQUESTER,department:"",location:""}),P=[{title:"All Roles",value:""},{title:"Requester",value:m.REQUESTER},{title:"Agent",value:m.AGENT},{title:"Supervisor",value:m.SUPERVISOR},{title:"Admin",value:m.ADMIN}],F={REQUESTER:"blue",AGENT:"green",SUPERVISOR:"purple",ADMIN:"red"},I=[{title:"All Status",value:""},{title:"Active",value:"true"},{title:"Inactive",value:"false"}],M=[{title:"Username",key:"username",sortable:!0},{title:"Full Name",key:"fullName",sortable:!0},{title:"Email",key:"email",sortable:!0},{title:"Role",key:"role",sortable:!0},{title:"Department",key:"department",sortable:!1},{title:"Status",key:"isActive",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],f={username:[e=>!!e||"Username is required",e=>e.length>=3||"Min 3 characters"],email:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],fullName:[e=>!!e||"Full name is required"],password:[e=>!r.value||!e||e.length>=6||"Min 6 characters"],newPassword:[e=>!e||e.length>=6||"Min 6 characters"]};async function b(){N.value=!0;try{const e=new URLSearchParams({page:w.value.toString(),limit:U.value.toString()});i.value.role&&e.append("role",i.value.role),i.value.isActive&&e.append("isActive",i.value.isActive);const l=await A.get(`/users?${e}`);k.value=l.data.data,x.value=l.data.meta.total}catch(e){console.error("Failed to fetch users:",e)}finally{N.value=!1}}function z(){r.value=!1,y.value=null,o.value={username:"",email:"",fullName:"",password:"",role:m.REQUESTER,department:"",location:""},d.value=!0}function $(e){r.value=!0,y.value=e,o.value={username:e.username,email:e.email,fullName:e.fullName,password:"",role:e.role,department:e.department||"",location:e.location||""},d.value=!0}async function T(){E.value=!0;try{const e={username:o.value.username,email:o.value.email,fullName:o.value.fullName,role:o.value.role};o.value.department&&(e.department=o.value.department),o.value.location&&(e.location=o.value.location),r.value&&y.value?(o.value.password&&(e.password=o.value.password),await A.patch(`/users/${y.value.id}`,e)):(e.password=o.value.password,await A.post("/users",e)),d.value=!1,await b()}catch(e){console.error("Failed to save user:",e)}finally{E.value=!1}}async function B(e){try{await A.patch(`/users/${e.id}`,{isActive:!e.isActive}),await b()}catch(l){console.error("Failed to update user status:",l)}}return j([w,U,i],b,{deep:!0}),G(b),(e,l)=>(Y(),L("div",null,[v("div",ee,[l[14]||(l[14]=v("div",null,[v("h1",{class:"text-h4"},"Users"),v("p",{class:"text-body-2 text-grey"},"Manage user accounts")],-1)),t(V,{color:"primary","prepend-icon":"mdi-plus",onClick:z},{default:s(()=>[...l[13]||(l[13]=[n(" Add User ",-1)])]),_:1})]),t(S,{class:"mb-4"},{default:s(()=>[t(q,null,{default:s(()=>[t(C,null,{default:s(()=>[t(p,{cols:"12",md:"6"},{default:s(()=>[t(R,{modelValue:i.value.role,"onUpdate:modelValue":l[0]||(l[0]=a=>i.value.role=a),items:P,label:"Role","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:s(()=>[t(R,{modelValue:i.value.isActive,"onUpdate:modelValue":l[1]||(l[1]=a=>i.value.isActive=a),items:I,label:"Status","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(S,null,{default:s(()=>[t(Z,{headers:M,items:k.value,loading:N.value,"items-per-page":U.value,page:w.value,"items-length":x.value,"onUpdate:page":l[2]||(l[2]=a=>w.value=a),"onUpdate:itemsPerPage":l[3]||(l[3]=a=>U.value=a),class:"elevation-0"},{"item.role":s(({item:a})=>[t(D,{color:F[a.role],size:"small",variant:"tonal"},{default:s(()=>[n(g(a.role),1)]),_:2},1032,["color"])]),"item.isActive":s(({item:a})=>[t(D,{color:a.isActive?"green":"grey",size:"small",variant:"tonal"},{default:s(()=>[n(g(a.isActive?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.department":s(({item:a})=>[n(g(a.department||"-"),1)]),"item.actions":s(({item:a})=>[t(V,{icon:"mdi-pencil",variant:"text",size:"small",onClick:O=>$(a)},null,8,["onClick"]),t(V,{icon:a.isActive?"mdi-account-off":"mdi-account-check",variant:"text",size:"small",color:a.isActive?"error":"success",onClick:O=>B(a)},null,8,["icon","color","onClick"])]),"no-data":s(()=>[v("div",le,[t(H,{size:"64",color:"grey-lighten-1"},{default:s(()=>[...l[15]||(l[15]=[n("mdi-account-group",-1)])]),_:1}),l[16]||(l[16]=v("p",{class:"text-h6 mt-4"},"No users found",-1))])]),_:1},8,["items","loading","items-per-page","page","items-length"])]),_:1}),t(_,{modelValue:d.value,"onUpdate:modelValue":l[12]||(l[12]=a=>d.value=a),"max-width":"600"},{default:s(()=>[t(S,null,{default:s(()=>[t(J,null,{default:s(()=>[n(g(r.value?"Edit User":"Create User"),1)]),_:1}),t(q,null,{default:s(()=>[t(K,{onSubmit:W(T,["prevent"])},{default:s(()=>[t(C,null,{default:s(()=>[t(p,{cols:"12",md:"6"},{default:s(()=>[t(c,{modelValue:o.value.username,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.username=a),label:"Username",rules:f.username,disabled:r.value,required:""},null,8,["modelValue","rules","disabled"])]),_:1}),t(p,{cols:"12",md:"6"},{default:s(()=>[t(c,{modelValue:o.value.email,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.email=a),label:"Email",type:"email",rules:f.email,required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(c,{modelValue:o.value.fullName,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.fullName=a),label:"Full Name",rules:f.fullName,required:""},null,8,["modelValue","rules"]),t(c,{modelValue:o.value.password,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.password=a),label:r.value?"New Password (leave empty to keep current)":"Password",type:"password",rules:r.value?f.newPassword:f.password,required:!r.value},null,8,["modelValue","label","rules","required"]),t(R,{modelValue:o.value.role,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.role=a),items:P.slice(1),label:"Role",required:""},null,8,["modelValue","items"]),t(C,null,{default:s(()=>[t(p,{cols:"12",md:"6"},{default:s(()=>[t(c,{modelValue:o.value.department,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.department=a),label:"Department"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:s(()=>[t(c,{modelValue:o.value.location,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.location=a),label:"Location"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(X,null,{default:s(()=>[t(h),t(V,{variant:"text",onClick:l[11]||(l[11]=a=>d.value=!1)},{default:s(()=>[...l[17]||(l[17]=[n("Cancel",-1)])]),_:1}),t(V,{color:"primary",loading:E.value,onClick:T},{default:s(()=>[n(g(r.value?"Save Changes":"Create User"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{se as default};
