import{d as G,b as K,R as O,B as Q,l as V,e,w as l,V as I,ad as W,z as f,A as X,o as N,f as P,g as k,k as x,m as Y,t as m,P as Z,j as t,I as h,J as ee,H as _,aa as S,n as c,c as L,q as M,T as D,r as E,s as R,v as p,a3 as j,N as z,x as $,S as H}from"./index-Cix3CRG3.js";const ae={class:"text-h4"},le={class:"text-h5"},se={class:"text-body-2 text-grey"},te=G({__name:"ProfileView",setup(oe){const U=K(),y=f(!1),b=f(!1),g=f(!1),F=f(""),B=f("success"),r=X(()=>U.user),u=f({fullName:"",email:"",department:"",location:""}),d=f({currentPassword:"",newPassword:"",confirmPassword:""}),C={currentPassword:[s=>!!s||"Current password is required"],newPassword:[s=>!!s||"New password is required",s=>s.length>=6||"Password must be at least 6 characters"],confirmPassword:[s=>!!s||"Please confirm your password",s=>s===d.value.newPassword||"Passwords do not match"]};function J(){r.value&&(u.value={fullName:r.value.fullName||"",email:r.value.email||"",department:r.value.department||"",location:r.value.location||""})}async function T(){var s;y.value=!0;try{await H.patch(`/users/${(s=r.value)==null?void 0:s.id}`,{fullName:u.value.fullName,email:u.value.email,department:u.value.department||void 0,location:u.value.location||void 0}),await U.fetchProfile(),w("Profile updated successfully","success")}catch(a){console.error("Failed to update profile:",a),w("Failed to update profile","error")}finally{y.value=!1}}async function q(){var s;if(d.value.newPassword!==d.value.confirmPassword){w("Passwords do not match","error");return}b.value=!0;try{await H.patch(`/users/${(s=r.value)==null?void 0:s.id}`,{password:d.value.newPassword}),d.value={currentPassword:"",newPassword:"",confirmPassword:""},w("Password changed successfully","success")}catch(a){console.error("Failed to change password:",a),w("Failed to change password","error")}finally{b.value=!1}}function w(s,a){F.value=s,B.value=a,g.value=!0}return O(J),(s,a)=>(N(),Q("div",null,[a[17]||(a[17]=V("h1",{class:"text-h4 mb-6"},"My Profile",-1)),e(I,null,{default:l(()=>[e(P,{cols:"12",md:"4"},{default:l(()=>[e(k,null,{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>{var o,A;return[e(Y,{color:"primary",size:"100",class:"mb-4"},{default:l(()=>{var i,v;return[V("span",ae,m(((v=(i=r.value)==null?void 0:i.fullName)==null?void 0:v.split(" ").map(n=>n[0]).join("").toUpperCase())||"U"),1)]}),_:1}),V("h3",le,m((o=r.value)==null?void 0:o.fullName),1),V("p",se,"@"+m((A=r.value)==null?void 0:A.username),1),e(Z,{color:"primary",variant:"tonal",class:"mt-2"},{default:l(()=>{var i;return[t(m((i=r.value)==null?void 0:i.role),1)]}),_:1}),e(h,{class:"my-4"}),e(ee,{density:"compact"},{default:l(()=>{var i,v;return[e(_,null,{prepend:l(()=>[e(c,null,{default:l(()=>[...a[8]||(a[8]=[t("mdi-email",-1)])]),_:1})]),default:l(()=>[e(S,null,{default:l(()=>{var n;return[t(m((n=r.value)==null?void 0:n.email),1)]}),_:1})]),_:1}),(i=r.value)!=null&&i.department?(N(),L(_,{key:0},{prepend:l(()=>[e(c,null,{default:l(()=>[...a[9]||(a[9]=[t("mdi-domain",-1)])]),_:1})]),default:l(()=>[e(S,null,{default:l(()=>{var n;return[t(m((n=r.value)==null?void 0:n.department),1)]}),_:1})]),_:1})):M("",!0),(v=r.value)!=null&&v.location?(N(),L(_,{key:1},{prepend:l(()=>[e(c,null,{default:l(()=>[...a[10]||(a[10]=[t("mdi-map-marker",-1)])]),_:1})]),default:l(()=>[e(S,null,{default:l(()=>{var n;return[t(m((n=r.value)==null?void 0:n.location),1)]}),_:1})]),_:1})):M("",!0)]}),_:1})]}),_:1})]),_:1})]),_:1}),e(P,{cols:"12",md:"8"},{default:l(()=>[e(k,{class:"mb-4"},{default:l(()=>[e(D,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...a[11]||(a[11]=[t("mdi-account-edit",-1)])]),_:1}),a[12]||(a[12]=t(" Edit Profile ",-1))]),_:1}),e(x,null,{default:l(()=>[e(E,{onSubmit:R(T,["prevent"])},{default:l(()=>[e(p,{modelValue:u.value.fullName,"onUpdate:modelValue":a[0]||(a[0]=o=>u.value.fullName=o),label:"Full Name",required:""},null,8,["modelValue"]),e(p,{modelValue:u.value.email,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.email=o),label:"Email",type:"email",required:""},null,8,["modelValue"]),e(I,null,{default:l(()=>[e(P,{cols:"12",md:"6"},{default:l(()=>[e(p,{modelValue:u.value.department,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value.department=o),label:"Department"},null,8,["modelValue"])]),_:1}),e(P,{cols:"12",md:"6"},{default:l(()=>[e(p,{modelValue:u.value.location,"onUpdate:modelValue":a[3]||(a[3]=o=>u.value.location=o),label:"Location"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(j,null,{default:l(()=>[e(z),e($,{color:"primary",loading:y.value,onClick:T},{default:l(()=>[...a[13]||(a[13]=[t(" Save Changes ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),e(k,null,{default:l(()=>[e(D,null,{default:l(()=>[e(c,{class:"mr-2"},{default:l(()=>[...a[14]||(a[14]=[t("mdi-lock",-1)])]),_:1}),a[15]||(a[15]=t(" Change Password ",-1))]),_:1}),e(x,null,{default:l(()=>[e(E,{onSubmit:R(q,["prevent"])},{default:l(()=>[e(p,{modelValue:d.value.currentPassword,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value.currentPassword=o),label:"Current Password",type:"password",rules:C.currentPassword},null,8,["modelValue","rules"]),e(p,{modelValue:d.value.newPassword,"onUpdate:modelValue":a[5]||(a[5]=o=>d.value.newPassword=o),label:"New Password",type:"password",rules:C.newPassword},null,8,["modelValue","rules"]),e(p,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":a[6]||(a[6]=o=>d.value.confirmPassword=o),label:"Confirm New Password",type:"password",rules:C.confirmPassword},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(j,null,{default:l(()=>[e(z),e($,{color:"primary",loading:b.value,disabled:!d.value.newPassword||!d.value.confirmPassword,onClick:q},{default:l(()=>[...a[16]||(a[16]=[t(" Change Password ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e(W,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=o=>g.value=o),color:B.value,timeout:"3000"},{default:l(()=>[t(m(F.value),1)]),_:1},8,["modelValue","color"])]))}});export{te as default};
